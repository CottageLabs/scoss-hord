window.$||(window.$=jQuery);
!function(n){n.fn.bindWithDelay=function(i,t,u,e,o){function l(){var i=n.extend(!0,{},arguments[0]),t=function(){r=null,u.apply(a,[i])};o||clearTimeout(r),o&&r||(r=setTimeout(t,e))}var r=null,a=this;return n.isFunction(t)&&(o=e,e=u,u=t,t=void 0),this.bind(i,t,l)}}(jQuery);
var edges={newEdge:function(e){return e||(e={}),new edges.Edge(e)},Edge:function(e){this.selector=edges.getParam(e.selector,"body"),this.search_url=edges.getParam(e.search_url,!1),this.datatype=edges.getParam(e.datatype,"jsonp"),this.preflightQueries=edges.getParam(e.preflightQueries,!1),this.baseQuery=edges.getParam(e.baseQuery,!1),this.openingQuery=edges.getParam(e.openingQuery,"undefined"!=typeof es?es.newQuery():!1),this.secondaryQueries=edges.getParam(e.secondaryQueries,!1),this.secondaryUrls=edges.getParam(e.secondaryUrls,!1),this.initialSearch=edges.getParam(e.initialSearch,!0),this.staticFiles=edges.getParam(e.staticFiles,[]),this.manageUrl=edges.getParam(e.manageUrl,!1),this.urlQuerySource=edges.getParam(e.urlQuerySource,"source"),this.template=edges.getParam(e.template,!1),this.components=edges.getParam(e.components,[]),this.renderPacks=edges.getParam(e.renderPacks,[edges.bs3,edges.nvd3,edges.highcharts,edges.google,edges.d3]),this.urlQuery=!1,this.urlParams={},this.shortUrl=!1,this.currentQuery=!1,this.result=!1,this.preflightResults={},this.realisedSecondaryQueries={},this.secondaryResults={},this.searching=!1,this.context=!1,this["static"]={},this.resources={},this.errorLoadingStatic=[],this.startup=function(){if(this.context=$(this.selector),this.context.trigger("edges:pre-init"),this.manageUrl){var e=this.getUrlParams();this.urlQuerySource in e&&(this.urlQuery=es.newQuery({raw:e[this.urlQuerySource]}),delete e[this.urlQuerySource]),this.urlParams=e}this.template&&this.template.draw(this);for(var t=0;t<this.components.length;t++){var r=this.components[t];r.init(this)}this.draw();var s=edges.objClosure(this,"startupPart2");this.loadStaticsAsync(s)},this.startupPart2=function(){var e=edges.objClosure(this,"startupPart3");this.runPreflightQueries(e)},this.startupPart3=function(){var e=this.openingQuery;this.urlQuery&&(e=this.urlQuery,this.urlQuery=!1);for(var t=0;t<this.components.length;t++){var r=this.components[t];r.contrib(e)}this.pushQuery(e),this.context.trigger("edges:post-init"),this.cycle()},this.doQuery=function(){this.cycle()},this.cycle=function(){if(!this.searching)if(this.searching=!0,this.shortUrl=!1,this.context.trigger("edges:pre-query"),this.manageUrl&&this.updateUrl(),this.search_url){var e=edges.objClosure(this,"cyclePart2");this.doPrimaryQuery(e)}else this.cyclePart2()},this.cyclePart2=function(){var e=edges.objClosure(this,"cyclePart3");this.runSecondaryQueries(e)},this.cyclePart3=function(){this.synchronise(),this.context.trigger("edges:pre-render"),this.draw(),this.context.trigger("edges:post-render"),this.searching=!1},this.synchronise=function(){for(var e=0;e<this.components.length;e++){var t=this.components[e];t.synchronise()}},this.draw=function(){for(var e=0;e<this.components.length;e++){var t=this.components[e];t.draw(this)}},this.reset=function(){this.context.trigger("edges:pre-reset");for(var e=this.cloneOpeningQuery(),t=0;t<this.components.length;t++){var r=this.components[t];r.contrib(e)}this.pushQuery(e),this.context.trigger("edges:post-reset"),this.cycle()},this.cloneQuery=function(){return this.currentQuery?$.extend(!0,{},this.currentQuery):!1},this.pushQuery=function(e){this.baseQuery&&e.merge(this.baseQuery),this.currentQuery=e},this.cloneBaseQuery=function(){return this.baseQuery?$.extend(!0,{},this.baseQuery):es.newQuery()},this.cloneOpeningQuery=function(){return this.openingQuery?$.extend(!0,{},this.openingQuery):es.newQuery()},this.doPrimaryQuery=function(e){var t={callback:e};es.doQuery({search_url:this.search_url,queryobj:this.currentQuery.objectify(),datatype:this.datatype,success:edges.objClosure(this,"querySuccess",["result"],t),error:edges.objClosure(this,"queryFail",t)})},this.queryFail=function(e){var t=e.context;this.context.trigger("edges:query-fail"),t()},this.querySuccess=function(e){this.result=e.result;var t=e.callback;this.context.trigger("edges:query-success"),t()},this.runPreflightQueries=function(e){if(!this.preflightQueries||0==Object.keys(this.preflightQueries).length)return void e();this.context.trigger("edges:pre-preflight");for(var t=[],r=Object.keys(this.preflightQueries),s=0;s<r.length;s++){var i=r[s];t.push({id:i,query:this.preflightQueries[i]})}var n=this,c=edges.newAsyncGroup({list:t,action:function(e){var t=e.entry,r=e.success_callback,s=e.error_callback;es.doQuery({search_url:n.search_url,queryobj:t.query.objectify(),datatype:n.datatype,success:r,error:s})},successCallbackArgs:["result"],success:function(e){var t=e.result,r=e.entry;n.preflightResults[r.id]=t},errorCallbackArgs:["result"],error:function(e){n.context.trigger("edges:error-preflight")},carryOn:function(){n.context.trigger("edges:post-preflight"),e()}});c.process()},this.runSecondaryQueries=function(e){if(this.realisedSecondaryQueries={},!this.secondaryQueries||0==Object.keys(this.secondaryQueries).length)return void e();var t=[];for(var r in this.secondaryQueries){var s={};s.query=this.secondaryQueries[r](this),s.id=r,s.search_url=this.search_url,this.secondaryUrls!==!1&&this.secondaryUrls.hasOwnProperty(r)&&(s.search_url=this.secondaryUrls[r]),t.push(s),this.realisedSecondaryQueries[r]=s.query}var i=this,n=edges.newAsyncGroup({list:t,action:function(e){var t=e.entry,r=e.success_callback;e.error_callback;es.doQuery({search_url:t.search_url,queryobj:t.query.objectify(),datatype:i.datatype,success:r,complete:!1})},successCallbackArgs:["result"],success:function(e){var t=e.result,r=e.entry;i.secondaryResults[r.id]=t},errorCallbackArgs:["result"],error:function(e){},carryOn:function(){e()}});n.process()},this.getComponent=function(e){for(var t=e.id,r=0;r<this.components.length;r++){var s=this.components[r];if(s.id===t)return s}return!1},this.category=function(e){for(var t=[],r=0;r<this.components.length;r++){var s=this.components[r];s.category===e&&t.push(s)}return t},this.getRenderPackObject=function(e,t){for(var r=0;r<this.renderPacks.length;r++){var s=this.renderPacks[r];if(s&&s.hasOwnProperty(e))return s[e](t)}},this.jq=function(e){return $(e,this.context)},this.getUrlParams=function(){var e={},t=window.location.href,r=!1;t.indexOf("#")>-1&&(r=t.slice(t.indexOf("#")),t=t.substring(0,t.indexOf("#")));for(var s=t.slice(t.indexOf("?")+1).split("&"),i=0;i<s.length;i++){var n=s[i].split("=");if(2===n.length){var c=decodeURIComponent(n[1]);("["==c[0]||"{"==c[0])&&(c=c.replace(/^"/,"").replace(/"$/,""),c=JSON.parse(c)),e[n[0]]=c}}return r&&(e["#"]=r),e},this.urlQueryArg=function(e){e||(e={include_query_string:!0,include_filters:!0,include_paging:!0,include_sort:!0,include_fields:!1,include_aggregations:!1,include_facets:!1});var t=JSON.stringify(this.currentQuery.objectify(e)),r={};return r[this.urlQuerySource]=encodeURIComponent(t),r},this.fullQueryArgs=function(){var e=$.extend(!0,{},this.urlParams);return $.extend(e,this.urlQueryArg()),e},this.fullUrlQueryString=function(){return this._makeUrlQuery(this.fullQueryArgs())},this._makeUrlQuery=function(e){for(var t=Object.keys(e),r=[],s=0;s<t.length;s++){var i=t[s],n=e[i];r.push(i+"="+n)}return r.join("&")},this.fullUrl=function(){var e=this.fullQueryArgs(),t="";e["#"]&&(t="#"+e["#"],delete e["#"]);var r=window.location.toString(),s=r.split("?"),i=s[0]+"?"+this._makeUrlQuery(e)+t;return i},this.updateUrl=function(){if("pushState"in window.history){var e="?"+this.fullUrlQueryString();window.history.pushState("","",e)}},this.loadStaticsAsync=function(e){if(!this.staticFiles||0==this.staticFiles.length)return this.context.trigger("edges:post-load-static"),void e();var t=this,r=edges.newAsyncGroup({list:this.staticFiles,action:function(e){var t=e.entry,r=e.success_callback,s=e.error_callback,i=(t.id,t.url),n=edges.getParam(t.datatype,"text");$.ajax({type:"get",url:i,dataType:n,success:r,error:s})},successCallbackArgs:["data"],success:function(e){var r=e.data,s=e.entry;if(s.processor){var i=s.processor({data:r});t.resources[s.id]=i,s.opening&&s.opening({resource:i,edge:t})}t["static"][s.id]=r},errorCallbackArgs:["data"],error:function(e){t.errorLoadingStatic.push(e.entry.id),t.context.trigger("edges:error-load-static")},carryOn:function(){t.context.trigger("edges:post-load-static"),e()}});r.process()},this.startup()},newAsyncGroup:function(e){return e||(e={}),new edges.AsyncGroup(e)},AsyncGroup:function(e){this.list=e.list,this.successCallbackArgs=e.successCallbackArgs,this.errorCallbackArgs=e.errorCallbackArgs;var t=e.action,r=e.success,s=e.carryOn,i=e.error;this.functions={action:t,success:r,carryOn:s,error:i},this.checkList=[],this.finished=!1,this.construct=function(e){for(var t=0;t<this.list.length;t++)this.checkList.push(0)},this.process=function(e){0==this.list.length&&this.functions.carryOn();for(var t=0;t<this.list.length;t++){var r={index:t},s=edges.objClosure(this,"_actionSuccess",this.successCallbackArgs,r),i=edges.objClosure(this,"_actionError",this.successCallbackArgs,r),n=!1;this.functions.action({entry:this.list[t],success_callback:s,error_callback:i,complete_callback:n})}},this._actionSuccess=function(e){var t=e.index;delete e.index,e.entry=this.list[t],this.functions.success(e),this.checkList[t]=1,this._isComplete()&&this._finalise()},this._actionError=function(e){var t=e.index;delete e.index,e.entry=this.list[t],this.functions.error(e),this.checkList[t]=-1,this._isComplete()&&this._finalise()},this._actionComplete=function(e){},this._isComplete=function(){return-1===$.inArray(0,this.checkList)},this._finalise=function(){this.finished||(this.finished=!0,this.functions.carryOn())},this.construct()},newRenderer:function(e){return e||(e={}),new edges.Renderer(e)},Renderer:function(e){this.component=e.component||!1,this.init=function(e){this.component=e},this.draw=function(e){}},newComponent:function(e){return e||(e={}),new edges.Component(e)},Component:function(e){this.id=e.id,this.renderer=e.renderer,this.category=e.category||"none",this.defaultRenderer=e.defaultRenderer||"newRenderer",this.init=function(e){this.edge=e,this.context=this.edge.jq("#"+this.id),this.renderer||(this.renderer=this.edge.getRenderPackObject(this.defaultRenderer)),this.renderer&&this.renderer.init(this)},this.draw=function(){this.renderer&&this.renderer.draw()},this.contrib=function(e){},this.synchronise=function(){},this.jq=function(e){return this.edge.jq(e)}},newSelector:function(e){return e||(e={}),edges.Selector.prototype=edges.newComponent(e),new edges.Selector(e)},Selector:function(e){this.field=e.field,this.display=e.display||this.field,this.active=e.active||!0,this.disabled=e.disabled||!1,this.category=e.category||"selector"},newTemplate:function(e){return e||(e={}),new edges.Template(e)},Template:function(e){this.draw=function(e){}},instantiate:function(e,t,r){t||(t={}),r&&(e.prototype=r(t));var s=new e(t);return r&&(s.__proto_constructor__=r),s},up:function(e,t,r){var s=new e.__proto_constructor__;s[t].apply(e,r)},objClosure:function(e,t,r,s){return function(){if(r){for(var i={},n=0;n<r.length;n++)arguments.length>n&&(i[r[n]]=arguments[n]);s&&(i=$.extend(i,s)),e[t](i)}else{var c=Array.prototype.slice,a=c.apply(arguments);s&&a.push(s),e[t].apply(e,a)}}},eventClosure:function(e,t,r){return function(s){(!r||r(s))&&(s.preventDefault(),e[t](this))}},css_classes:function(e,t,r){var s=e+"-"+t;return r&&(s+=" "+s+"-"+r.component.id),s},css_class_selector:function(e,t,r){var s="."+e+"-"+t;return r&&(s+=s+"-"+r.component.id),s},css_id:function(e,t,r){var s=e+"-"+t;return r&&(s+="-"+r.component.id),s},css_id_selector:function(e,t,r){return"#"+edges.css_id(e,t,r)},on:function(e,t,r,s,i,n){r.component&&r.component.id?t=t+"."+r.component.id:r.namespace&&(t=t+"."+r.namespace);var c=edges.eventClosure(r,s,n);i?r.component?r.component.jq(e).bindWithDelay(t,c,i):r.edge?r.edge.jq(e).bindWithDelay(t,c,i):$(e).bindWithDelay(t,c,i):r.component?r.component.jq(e).on(t,c):r.edge?r.edge.jq(e).on(t,c):$(e).on(t,c)},getUrlParams:function(){var e={},t=window.location.href,r=!1;t.indexOf("#")>-1&&(r=t.slice(t.indexOf("#")),t=t.substring(0,t.indexOf("#")));for(var s=t.slice(t.indexOf("?")+1).split("&"),i=0;i<s.length;i++){var n=s[i].split("=");if(2===n.length){var c=decodeURIComponent(n[1]);("["==c[0]||"{"==c[0])&&(c=c.replace(/^"/,"").replace(/"$/,""),c=JSON.parse(c)),e[n[0]]=c}}return r&&(e["#"]=r),e},escapeHtml:function(e,t){if(void 0===t&&(t=""),void 0===e||null==e)return t;try{return"function"!=typeof e.replace?e:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}catch(r){return t}},objVal:function(e,t,r){void 0===r&&(r=!1);for(var s=e.split("."),i=t,n=0;n<s.length;n++){var c=s[n];if(!(c in i))return r;i=i[c]}return i},getParam:function(e,t){return void 0!==e?e:t},safeId:function(e){return e.replace(/&/g,"_").replace(/</g,"_").replace(/>/g,"_").replace(/"/g,"_").replace(/'/g,"_").replace(/\./gi,"_").replace(/\:/gi,"_").replace(/\s/gi,"_")},numFormat:function(e){var t=edges.getParam(e.reflectNonNumbers,!1),r=edges.getParam(e.prefix,""),s=edges.getParam(e.zeroPadding,!1),i=edges.getParam(e.decimalPlaces,!1),n=edges.getParam(e.thousandsSeparator,!1),c=edges.getParam(e.decimalSeparator,"."),a=edges.getParam(e.suffix,"");return function(e){var o=parseFloat(e);if(isNaN(o))return t?e:o;o=i!==!1?o.toFixed(i):o.toString();var u=o.split(".");if(s!==!1){for(var h=s-u[0].length,l="",d=0;h>d;d++)l+="0";u[0]=l+u[0]}return n!==!1&&(u[0]=u[0].replace(/\B(?=(\d{3})+(?!\d))/g,n)),1==u.length?r+u[0]+a:r+u[0]+c+u[1]+a}},numParse:function(e){var t=new RegExp(",","g");return function(e){return e=e.trim(),e=e.replace(t,""),""===e?0:parseFloat(e)}},isEmptyObject:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}};
$.extend(edges,{newChart:function(e){return e||(e={}),edges.Chart.prototype=edges.newComponent(e),new edges.Chart(e)},Chart:function(e){this.category=e.category||"chart",this.display=e.display||"",this.dataSeries=e.dataSeries||!1,this.dataFunction=e.dataFunction||!1,this.dataFunctionClosure=e.dataFunctionClosure||!1,this.aggregations=e.aggregations||[],this.dfArgs=e.dfArgs||{useAggregations:[],seriesKeys:{}},this.dataSeriesNameMapFunction=edges.getParam(e.dataSeriesNameMapFunction,!1),this.dataSeriesNameMap=edges.getParam(e.dataSeriesNameMap,{}),this.defaultRenderer=e.defaultRenderer||"newMultibarRenderer",this.init=function(e){edges.newComponent().init.call(this,e);for(var t=0;t<this.aggregations.length;t++){var a=this.aggregations[t];-1===$.inArray(a.name,this.dfArgs.useAggregations)&&this.dfArgs.useAggregations.push(a.name)}this.aggregations.length>0&&this.dataFunctionClosure&&(this.dataFunction=this.dataFunctionClosure(this.dfArgs))},this.contrib=function(e){for(var t=0;t<this.aggregations.length;t++)e.addAggregation(this.aggregations[t])},this.synchronise=function(){this.dataFunction&&(this.dataSeries=this.dataFunction(this)),this.dataSeriesNameMapFunction&&(this.dataSeriesNameMap=this.dataSeriesNameMapFunction(this))}},ChartDataFunctions:{terms:function(e){var t=e.useAggregations||[],a=e.seriesKeys||{};return function(e){var r=[];if(!e.edge.result)return r;for(var n=0;n<t.length;n++){var s=t[n],i=e.edge.result.data.aggregations[s].buckets,u={};u.key=a[s],u.values=[];for(var l=0;l<i.length;l++){var o=i[l].doc_count,d=i[l].key;u.values.push({label:d,value:o})}r.push(u)}return r}},termsStats:function(e){var t=e.useAggregations||[],a=e.seriesKeys||{},r=e.seriesFor||[];return function(e){var n=[];if(!e.edge.result)return n;for(var s=0;s<t.length;s++)for(var i=t[s],u=i.split(" "),l=0;l<r.length;l++){var o=r[l],d={};d.key=a[i+" "+o],d.values=[];for(var g=e.edge.result.data.aggregations[u[0]].buckets,h=0;h<g.length;h++){var f=g[h][u[1]],c=g[h].key,v=f[o];d.values.push({label:c,value:v})}n.push(d)}return n}},recordsXY:function(e){var t=e.x,a=void 0===e.x_default?0:e.x_default,r=e.y,n=void 0===e.y_default?0:e.y_default,s=e.key;return function(e){var i=[];if(!e.edge.result)return i;var u={};u.key=s,u.values=[];for(var l=e.edge.result.results(),o=0;o<l.length;o++){var d=l[o],g=edges.objVal(t,d,a),h=edges.objVal(r,d,n);u.values.push({label:g,value:h})}return i.push(u),i}},cumulativeXY:function(e){var t=e.x,a=void 0===e.x_default?0:e.x_default,r=e.y,n=void 0===e.y_default?0:e.y_default,s=e.key,i=e.accumulate||"y";return function(e){var u=[];if(!e.edge.result)return u;var l={};l.key=s,l.values=[];for(var o=0,d=e.edge.result.results(),g=0;g<d.length;g++){var h=d[g],f=edges.objVal(t,h,a),c=edges.objVal(r,h,n);"x"===i?(o+=f,l.values.push({label:o,value:c})):"y"===i&&(o+=c,l.values.push({label:f,value:o}))}return u.push(l),u}},totalledList:function(e){var t=e.listPath||"",a=e.seriesKey||"",r=e.keyField||!1,n=e.valueField||!1;return function(e){var s=[];if(!e.edge.result)return s;var i={};i.key=a,i.values=[];for(var u={},l=e.edge.result.results(),o=0;o<l.length;o++)for(var d=l[o],g=edges.objVal(t,d,[]),h=0;h<g.length;h++){var f=g[h],c=edges.objVal(r,f,!1),v=edges.objVal(n,f,0);c in u?u[c]+=v:u[c]=v}for(c in u){var p=u[c];i.values.push({label:c,value:p})}return s.push(i),s}}},newPieChart:function(e){return e||(e={}),edges.PieChart.prototype=edges.newChart(e),new edges.PieChart(e)},PieChart:function(e){this.defaultRenderer=e.defaultRenderer||"newPieChartRenderer"},newHorizontalMultibar:function(e){return e||(e={}),edges.HorizontalMultibar.prototype=edges.newChart(e),new edges.HorizontalMultibar(e)},HorizontalMultibar:function(e){this.defaultRenderer=e.defaultRenderer||"newHorizontalMultibarRenderer"},newMultibar:function(e){return e||(e={}),edges.Multibar.prototype=edges.newChart(e),new edges.Multibar(e)},Multibar:function(e){this.defaultRenderer=e.defaultRenderer||"newMultibarRenderer"},newSimpleLineChart:function(e){return e||(e={}),edges.SimpleLineChart.prototype=edges.newChart(e),new edges.SimpleLineChart(e)},SimpleLineChart:function(e){this.xAxisLabel=e.xAxisLabel||"",this.yAxisLabel=e.yAxisLabel||"",this.defaultRenderer=e.defaultRenderer||"newSimpleLineChartRenderer"},newChartsTable:function(e){return e||(e={}),edges.ChartsTable.prototype=edges.newComponent(e),new edges.ChartsTable(e)},ChartsTable:function(e){this.chartComponents=edges.getParam(e.chartComponents,!1),this.tabularise=edges.getParam(e.tabularise,!1),this.defaultRenderer=e.defaultRenderer||"newChartsTableRenderer",this.results=[],this.synchronise=function(){if(this.results=[],this.chartComponents){for(var e=[],t=0;t<this.edge.components.length;t++){var a=this.edge.components[t];$.inArray(a.id,this.chartComponents)>-1&&e.push(a)}this.tabularise&&(this.results=this.tabularise(e))}}}});
$.extend(!0,edges,{chartjs:{newRadar:function(e){return edges.instantiate(edges.chartjs.Radar,e,edges.newRenderer)},Radar:function(e){this.options=edges.getParam(e.options,{}),this.dataSeriesProperties=edges.getParam(e.dataSeriesProperties,{}),this.download=edges.getParam(e.download,!1),this.downloadText=edges.getParam(e.downloadText,"download"),this.downloadName=edges.getParam(e.downloadName,"image"),this.namespace="edges-chartjs-radar",this.chart=!1,this.draw=function(){var e=this._dataSeriesToDatasets();if(e!==!1)if(this.chart===!1){var a=edges.css_classes(this.namespace,"container",this),s=edges.css_classes(this.namespace,"download-container",this),t=edges.css_classes(this.namespace,"chart",this),d=edges.css_id(this.namespace,"canvas",this),i=edges.css_id_selector(this.namespace,"canvas",this),n=edges.css_id(this.namespace,"download",this),o='<div class="'+a+'">                        <div class="'+t+'">                            <canvas id="'+d+'" width="400" height="400"></canvas>                        </div>';this.download&&(o+='<div class="'+s+'"><a href="#" id="'+n+'">'+edges.escapeHtml(this.downloadText)+"</a></div>"),this.component.context.html(o);var r=this.component.context.find(i);if(this.chart=new Chart(r,{type:"radar",data:e,options:this.options}),this.download){var h=edges.css_id_selector(this.namespace,"download",this);edges.on(h,"click",this,"doDownload")}}else{for(var c=0;c<e.datasets.length;c++)this.chart.data.datasets[c].data=e.datasets[c].data,this.chart.data.datasets[c].label=e.datasets[c].label;this.chart.update()}},this._dataSeriesToDatasets=function(){if(this.component.dataSeries===!1||0==this.component.dataSeries.length)return!1;var e={};e.labels=this.component.dataSeries[0].values.map(function(e){return e.label}),e.datasets=[];for(var a=0;a<this.component.dataSeries.length;a++){var s=this.component.dataSeries[a],t={label:edges.getParam(this.component.dataSeriesNameMap[s.key],s.key),data:s.values.map(function(e){return e.value})};this.dataSeriesProperties.hasOwnProperty(s.key)&&$.extend(t,this.dataSeriesProperties[s.key]),e.datasets.push(t)}return e},this.doDownload=function(e){if(this.download){var a=edges.css_id_selector(this.namespace,"canvas",this),s=this.component.jq(a)[0].toDataURL("image/png"),t=document.createElement("a");document.body.appendChild(t),t.style="display: none",t.href=s,t.download=this.downloadName+".png",t.click()}}}}});
var hord={DATA:{},init:function(e){var t=hord.detectMode();"view"===t?hord.view(e):"edit"===t&&hord.edit(e)},view:function(e){var t=e.source_selector,r=e.working_selector,a=(e.editUrlTemplate,e.editUrlRegex,e.viewUrlTemplate,e.viewUrlRegex),s='<div class="row">            <div class="col-sm-12 col-md-8 col-md-offset-2">                <div id="radar-diagrams"></div>            </div>        </div>';$(r).html(s),hord.prePopulateFromURL({selector:t,urlRegex:a});var i=hord.readConfig({form_selector:t});hord.DATA.config=i;for(var o=[],n=0;n<i.charts.length;n++){var c=i.charts[n];$.inArray("view",i.chart_info[c].visibility)>-1&&o.push(hord._makeChartComponent({form_selector:t,chart_id:c,config:i,download:!0}))}var d=edges.newEdge({selector:"#radar-diagrams",template:hord.newRadarDiagramsTemplate(),components:o});hord.DATA.edge=d,hord.cycle({form_selector:t})},edit:function(e){var t=e.source_selector,r=e.working_selector,a=e.editUrlTemplate,s=e.editUrlRegex,i=e.viewUrlTemplate,o=(e.viewUrlRegex,$(t).html());$(t).html("");var n='<div class="row">            <div class="col-md-6">                <div class="section-navigation"></div>                <div id="hord"></div>                <div class="section-navigation"></div>            </div>            <div class="col-md-6">                <div id="radar-diagrams"></div>            </div>        </div>';$(r).html(n);var c="#hord";$(c,r).html(o),hord.newSectionManager({form_selector:c,scrollSelector:r}),hord.prePopulateFromURL({selector:c,urlRegex:s});var d=hord.readConfig({form_selector:c});hord.DATA.config=d;for(var l=[],h=0;h<d.charts.length;h++){var u=d.charts[h];$.inArray("edit",d.chart_info[u].visibility)>-1&&l.push(hord._makeChartComponent({form_selector:c,chart_id:u,config:d}))}l.push(hord.newPersistentLink({id:"persistent-link",category:"radar",sourceChart:"main",resource:c,editUrlTemplate:a,viewUrlTemplate:i}));var m=edges.newEdge({selector:"#radar-diagrams",template:hord.newRadarDiagramsTemplate(),components:l});hord.DATA.edge=m,$("[data-hord]",c).on("change",function(e){hord.cycle({form_selector:c,update_date:!0})}),hord.cycle({form_selector:c})},readConfig:function(e){var t=e.form_selector,r={},a=$("[data-hord=config]",t);r.charts=a.attr("data-hord-charts").split(",").map(function(e){return e.trim()}),r.chart_info={};for(var s=0;s<r.charts.length;s++){var i=r.charts[s];r.chart_info[i]={};var o=a.attr("data-hord-charts-"+i+"-name");o&&(r.chart_info[i].name=o);var n=a.attr("data-hord-charts-"+i+"-size");n&&(r.chart_info[i].size=parseInt(n));var c=a.attr("data-hord-charts-"+i+"-visibility");c&&(r.chart_info[i].visibility=c.split(",").map(function(e){return e.trim()}))}return r},_makeChartComponent:function(e){var t=e.chart_id,r=e.form_selector,a=e.config,s=edges.getParam(e.download,!1),i=edges.getParam(a.chart_info[t].name,t),o=edges.getParam(a.chart_info[t].size,10);return edges.newChart({id:t,category:"radar",dataFunction:hord.dataFunction({chart:t,resource:r}),dataSeriesNameMapFunction:hord.dataSeriesNameMap({resource:r,subtitle:i}),renderer:edges.chartjs.newRadar({download:s,downloadName:edges.safeId(i),options:{scale:{ticks:{beginAtZero:!0,min:0,max:o,stepSize:1,suggestedMin:0,suggestedMax:o,callback:function(){return""}}},legend:{labels:{fontStyle:"bold"},onClick:function(){}}},dataSeriesProperties:{results:{fill:!0,backgroundColor:"rgba(87, 153, 199, 0.3)",borderColor:"#5799C7",pointBackgroundColor:"#5799C7",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(220,220,220,1)"}}})})},detectMode:function(){var e=edges.getUrlParams();return edges.getParam(e.mode,"edit")},dataSeriesNameMap:function(e){var t=e.resource,r=e.subtitle;return function(e){if(!e.edge.resources.hasOwnProperty(t))return{};var a=r,s=e.edge.resources[t].title;if(""!=s&&(a+=" - "+s,hord.DATA.date)){var i=hord.formatDate(hord.DATA.date);a+=", "+i}return{results:a}}},formatDate:function(e){var t=e.getUTCDate(),r=e.getUTCMonth(),a=e.getUTCFullYear(),s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return t+" "+s[r]+" "+a},prePopulateFromURL:function(e){var t=e.selector,r=e.urlRegex,a=r.exec(window.location.href);if(null!==a){var s=atob(a[1]).split("|");if(2===s.length){var i=s[0].split(",");if(2===i.length&&($("input[data-hord=title]").val(i[0]),hord.DATA.date=new Date(parseInt(i[1])),""!==s[1]))for(var o=s[1].split(","),n=0;n<o.length;n++){var c=o[n],d="input[name="+c+"]";$(d,t).prop("checked",!0)}}}},cycle:function(e){var t=edges.getParam(e.update_date,!1);hord.readForm({selector:e.form_selector}),hord.DATA.date&&t!==!0||(hord.DATA.date=new Date),hord.DATA.edge.cycle()},newRadarDiagramsTemplate:function(e){return edges.instantiate(hord.RadarDiagramsTemplate,e,edges.newTemplate)},RadarDiagramsTemplate:function(e){this.namespace="hord-radar-diagrams",this.draw=function(e){this.edge=e;for(var t=edges.css_classes(this.namespace,"container"),r=edges.css_classes(this.namespace,"section"),a='<div class="'+t+'">',s=e.category("radar"),i=0;i<s.length;i++)a+='<div class="'+r+'">                    <div class="row"><div class="col-md-12"><div id="'+s[i].id+'"></div></div></div>                </div>';e.context.html(a)}},newPersistentLink:function(e){return edges.instantiate(hord.PersistentLink,e,edges.newComponent)},PersistentLink:function(e){this.sourceChart=e.sourceChart,this.resource=e.resource,this.editUrlTemplate=e.editUrlTemplate,this.viewUrlTemplate=e.viewUrlTemplate,this.renderer=hord.newPersistentLinkRenderer(),this.summary="",this.synchronise=function(){if(this.summary="",this.edge.resources.hasOwnProperty(this.resource)){var e=this.edge.resources[this.resource].title,t="";e&&(t=hord.DATA.date.getTime()),this.summary+=e+","+t+"|";var r="",a=this.edge.resources[this.resource].charts[this.sourceChart];for(var s in a)a[s].selected_values.length>0&&(0!=r.length&&(r+=","),r+=a[s].selected_values.join(","));this.summary+=r}}},newPersistentLinkRenderer:function(e){return edges.instantiate(hord.PersistentLinkRenderer,e,edges.newRenderer)},PersistentLinkRenderer:function(e){this.namespace="hord-persistent-link",this.draw=function(){var e=btoa(this.component.summary),t=this.component.editUrlTemplate.replace("{summary}",e),r=this.component.viewUrlTemplate.replace("{summary}",e),a="<p>To return to this form and make changes, bookmark the following URL:</p>";a+='<div style="word-wrap: break-word"><a href="'+t+'">'+t+"</a></div>",a+="<br><br>",a+="<p>To view or share the diagrams, bookmark the following URL:</p>",a+='<div style="word-wrap: break-word"><a href="'+r+'">'+r+"</a></div>",this.component.context.html(a),window.history.replaceState&&window.history.replaceState({},null,t)}},dataFunction:function(e){var t=e.resource,r=e.chart;return function(e){if(!e.edge.resources.hasOwnProperty(t))return[];for(var a=e.edge.resources[t].charts[r],s=[],i=0;i<hord.DATA.axes.length;i++){var o=hord.DATA.axes[i].id;if(a.hasOwnProperty(o)){var n=a[o].name,c=a[o].length;s.push({label:n,value:c})}}return[{key:"results",values:s}]}},readForm:function(e){for(var t=e.selector,r=$("[data-hord]",t),a=[],s=[],i="",o=0;o<r.length;o++){var n=$(r[o]),c=n.attr("data-hord");if("axis"===c){var d=hord._readAxisConfig(n);a.push(d)}else if("value"===c){var l=hord._readValueConfig(n);s.push(l)}else"title"===c&&(i=n.val())}var h=hord._listCharts({axes:a}),u={};u.title=i,u.charts={};for(var o=0;o<h.length;o++){var m=h[o];u.charts[m]={};for(var g=hord._listChartAxes({chart:m,axes:a}),v=0;v<g.length;v++){var f=g[v],p=hord._getLength({chart:m,axisid:f.id,values:s});u.charts[m][f.id]={name:f.name,length:p.length,selected_values:p.selected}}}hord.DATA.edge.resources[t]=u,hord.DATA.axes=a,hord.DATA.values=s,hord.DATA.charts=h,hord.DATA.data=u},_getLength:function(e){for(var t=e.chart,r=e.axisid,a=e.values,s=0,i=[],o=0;o<a.length;o++){var n=a[o];n.axisid===r&&n.checked===!0&&t in n.weights&&(s+=n.weights[t],i.push(n.name))}return{length:s,selected:i}},_listChartAxes:function(e){for(var t=e.chart,r=e.axes,a=[],s=0;s<r.length;s++){var i=r[s];$.inArray(t,i.charts)>-1&&a.push(i)}return a},_listCharts:function(e){for(var t=e.axes,r=new Set,a=0;a<t.length;a++)for(var s=t[a],i=0;i<s.charts.length;i++){var o=s.charts[i];r.add(o)}return Array.from(r)},_readAxisConfig:function(e){var t=e.attr("data-hord-axisid"),r=e.attr("data-hord-charts"),a=e.attr("data-hord-name");return r=r?r.split(",").map(function(e){return e.trim()}):[],a||(a=e.text()),{id:t,charts:r,name:a}},_readValueConfig:function(e){var t=e.attr("data-hord-axisid"),r=e.attr("data-hord-weight"),a=e.attr("data-hord-charts"),s=e.attr("name"),i=e.is(":checked");r=r?parseFloat(r):1,a=a?a.split(",").map(function(e){return e.trim()}):[];for(var o={},n=0;n<a.length;n++){var c=e.attr("data-hord-weight-"+a[n]);c=c?parseFloat(c):r,o[a[n]]=c}return{axisid:t,name:s,checked:i,weights:o}},newSectionManager:function(e){return edges.instantiate(hord.SectionManager,e)},SectionManager:function(e){this.form_selector=e.form_selector,this.scrollSelector=e.scrollSelector,this.context=!1,this.currentSection=0,this.maxSection=0,this.sections=!1,this.namespace="section-manager",this.init=function(){this.context=$(this.form_selector),this._drawNavigation(),this.sections=this.context.find("section"),this.maxSection=this.sections.length,this._activateSection({section:0})},this._activateSection=function(e){for(var t=e.section,r=0;r<this.sections.length;r++){var a=$(this.sections[r]);a.attr("data-section",String(r)),a.hide(),r===t&&a.show()}this.currentSection=t,this._setPrevNext()},this._drawNavigation=function(){var e=edges.css_classes(this.namespace,"prev"),t=edges.css_classes(this.namespace,"next"),r='<span class="'+e+'"></span>';r+='<span class="'+t+'"></span>';$(".section-navigation").html(r)},this._setPrevNext=function(){var e=this.currentSection-1,t=this.currentSection+1;0>e&&(e=!1),t>=this.maxSection&&(t=!1);var r=edges.css_class_selector(this.namespace,"prev"),a=edges.css_class_selector(this.namespace,"next");if(e===!1){var s=edges.css_classes(this.namespace,"disabled"),i='<span class="'+s+' btn btn-default" disabled>&laquo; previous section</span>';$(r).html(i)}else{var o=edges.css_classes(this.namespace,"prev-link"),i='<a href="#" class="'+o+' btn btn-info" data-target="'+String(e)+'">&laquo; previous section</a>';$(r).html(i);var n=edges.css_class_selector(this.namespace,"prev-link");edges.on(n,"click",this,"linkClicked")}if(t===!1){var s=edges.css_classes(this.namespace,"disabled"),i='<span class="'+s+' btn btn-default" disabled>next section &raquo;</span>';$(a).html(i)}else{var c=edges.css_classes(this.namespace,"next-link"),i='<a href="#" class="'+c+' btn btn-info" data-target="'+String(t)+'">next section &raquo;</a>';$(a).html(i);var d=edges.css_class_selector(this.namespace,"next-link");edges.on(d,"click",this,"linkClicked")}},this.linkClicked=function(e){var t=$(e).attr("data-target");this._activateSection({section:parseInt(t)}),this.doScroll()},this.doScroll=function(){var e=$(this.scrollSelector).offset().top,t=$("html,body").scrollTop();t>e&&$("html,body").animate({scrollTop:$(this.scrollSelector).offset().top},500)},this.init()}};
